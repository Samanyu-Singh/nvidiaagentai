<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LegalLensIQ - Terms of Service Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .input-section, .results-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .input-section h2, .results-section h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 200px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #4a5568;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-item {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .result-item.risk {
            background: #fef5e7;
            border-left-color: #f6ad55;
        }

        .result-item.compliance {
            background: #f0fff4;
            border-left-color: #68d391;
        }

        .result-item.recommendation {
            background: #fef5e7;
            border-left-color: #f6ad55;
        }

        .score-display {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .score-number {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .score-fair {
            color: #38a169;
        }

        .score-moderate {
            color: #d69e2e;
        }

        .score-unfair {
            color: #e53e3e;
        }

        .status {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .sample-btn {
            background: #4a5568;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
        }

        .sample-btn:hover {
            background: #2d3748;
        }

        /* Chatbot Styles */
        .chatbot-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .chat-container {
            max-width: 100%;
            margin-top: 1rem;
        }

        .chat-messages {
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            margin-bottom: 1rem;
        }

        .message {
            margin-bottom: 1rem;
            display: flex;
        }

        .user-message {
            justify-content: flex-end;
        }

        .bot-message {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.4;
        }

        .user-message .message-content {
            background: #3b82f6;
            color: white;
        }

        .bot-message .message-content {
            background: #f1f5f9;
            color: #1e293b;
            border: 1px solid #e2e8f0;
        }

        .chat-input-container {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .send-btn {
            padding: 0.75rem 1.5rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .send-btn:hover {
            background: #2563eb;
        }

        .send-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: flex;
            gap: 0.25rem;
            padding: 0.75rem 1rem;
            background: #f1f5f9;
            border-radius: 12px;
            max-width: 60px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #64748b;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç LegalLensIQ</h1>
            <p>Terms of Service Analyzer - Built with NVIDIA's AgentIQ Toolkit</p>
        </div>

        <div class="input-section">
            <h2>üìÑ Document Input</h2>
            <form id="analysisForm">
                <div class="form-group">
                    <label for="documentTitle">Document Title:</label>
                    <input type="text" id="documentTitle" value="Sample Terms of Service" required>
                </div>
                
                <div class="form-group">
                    <label for="documentType">Document Type:</label>
                    <select id="documentType">
                        <option value="Terms of Service">Terms of Service</option>
                        <option value="Privacy Policy">Privacy Policy</option>
                        <option value="EULA">End User License Agreement</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="documentContent">Document Content:</label>
                    <textarea id="documentContent" placeholder="Paste your legal document here..." required>
Terms of Service

1. Data Collection and Usage
We may collect and sell your personal information to third parties for marketing purposes. 
We also track your browsing history across websites and collect location data.

2. Account Termination
We reserve the right to terminate your account at any time without notice or explanation.

3. Dispute Resolution
All disputes must be resolved through binding arbitration. You waive your right to a jury trial.

4. No Refunds
All sales are final. No refunds will be provided under any circumstances.

5. Privacy Rights
You have the right to know what data we collect, request deletion of your data, and opt out of data sharing. 
California residents have additional rights under CCPA.

By using our service, you waive all legal rights and agree to these terms.</textarea>
                </div>
                
                <button type="submit" class="btn" id="analyzeBtn">üîç Analyze Document</button>
                <button type="button" class="sample-btn" onclick="loadSampleDocument()">Load Sample Document</button>
            </form>
        </div>

        <div class="results-section">
            <h2>üìä Analysis Results</h2>
            <div id="loadingSection" class="loading hidden">
                <div class="spinner"></div>
                <p>Analyzing document...</p>
            </div>
            
            <div id="resultsSection" class="hidden">
                <div class="score-display">
                    <div id="scoreNumber" class="score-number"></div>
                    <div id="status" class="status"></div>
                    <p>Fairness Score</p>
                </div>
                
                <div id="riskAnalysis"></div>
                <div id="complianceCheck"></div>
                <div id="recommendations"></div>
            </div>
        </div>

        <!-- Legal Assistant Chatbot -->
        <div class="chatbot-section">
            <h2>üí¨ Legal Assistant Chatbot</h2>
            <div class="chat-container">
                <div id="chatMessages" class="chat-messages">
                    <div class="message bot-message">
                        <div class="message-content">
                            üëã Hi! I'm your legal assistant. Ask me anything about the analyzed document, legal terms, or privacy concerns. I can explain complex clauses in plain English and help you understand your rights.
                        </div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" id="chatInput" placeholder="Ask about legal terms, privacy, or document analysis..." class="chat-input">
                    <button id="sendMessage" class="send-btn">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced risk patterns for privacy policies and ToS
        const riskPatterns = {
            mandatory_arbitration: [/arbitration.*shall.*determined/gi, /mandatory.*arbitration/gi, /binding.*arbitration/gi, /JAMS.*arbitration/gi, /waive.*right.*jury.*trial/gi],
            broad_liability_waivers: [/no.*liability.*damages/gi, /disclaim.*all.*warranties/gi, /as.*is.*as.*available/gi, /consequential.*damages/gi],
            broad_termination_rights: [/terminate.*account.*without.*notice/gi, /suspend.*account.*sole.*discretion/gi, /violation.*terms.*terminate/gi],
            automatic_renewal: [/automatically.*renew/gi, /auto.*renewal/gi, /recurring.*subscription/gi],
            excessive_data_collection: [/location.*data/gi, /biometric.*identifiers/gi, /faceprints.*voiceprints/gi, /keystroke.*patterns/gi, /clipboard.*information/gi, /social.*network.*contacts/gi, /phone.*contacts/gi, /precise.*location/gi, /GPS.*information/gi, /metadata.*upload/gi, /device.*identifiers/gi, /advertising.*identifiers/gi, /IP.*address.*geolocation/gi],
            no_refunds: [/no.*refunds/gi, /non.*refundable/gi, /all.*sales.*final/gi],
            data_selling: [/sell.*personal.*information/gi, /share.*data.*third.*parties/gi, /advertisers.*share.*information/gi, /business.*partners.*share/gi, /cross.*context.*behavioral.*advertising/gi, /targeted.*advertising/gi, /personalized.*advertising/gi],
            unilateral_changes: [/change.*terms.*any.*time/gi, /update.*privacy.*policy.*time/gi, /reserve.*right.*change/gi],
            sole_discretion_clauses: [/sole.*discretion/gi, /our.*discretion/gi, /company.*discretion/gi],
            waiver_of_rights: [/waive.*all.*rights/gi, /waive.*legal.*rights/gi, /irrevocably.*waive/gi],
            extensive_data_sharing: [/share.*with.*service.*providers/gi, /share.*with.*business.*partners/gi, /share.*with.*advertisers/gi, /corporate.*group.*entities/gi, /global.*company/gi, /international.*transfer/gi, /servers.*outside.*united.*states/gi],
            indefinite_data_retention: [/retain.*as.*long.*necessary/gi, /retain.*legitimate.*business.*interest/gi, /retain.*legal.*obligations/gi, /retain.*improve.*develop/gi, /keep.*account.*long.*account/gi],
            broad_data_use: [/use.*advertising.*marketing/gi, /use.*targeted.*advertising/gi, /use.*personalized.*content/gi, /use.*infer.*information/gi, /use.*demographic.*classification/gi, /use.*content.*recommendations/gi, /use.*machine.*learning/gi, /use.*AI.*training/gi, /use.*research.*purposes/gi],
            lack_of_user_control: [/no.*opt.*out.*data.*collection/gi, /cannot.*opt.*out.*tracking/gi, /required.*data.*collection/gi, /cannot.*disable.*cookies/gi, /cannot.*delete.*account/gi, /limited.*data.*deletion/gi]
        };

        // Enhanced compliance patterns
        const compliancePatterns = {
            gdpr: [/right.*to.*deletion/gi, /data.*portability/gi, /explicit.*consent/gi, /data.*processing.*basis/gi, /privacy.*policy/gi, /data.*protection/gi, /personal.*data.*rights/gi, /lawful.*basis.*processing/gi, /data.*subject.*rights/gi, /privacy.*by.*design/gi],
            coppa: [/children.*under.*13/gi, /parental.*consent/gi, /collect.*child.*data/gi, /age.*verification/gi, /minor.*protection/gi, /children.*privacy.*policy/gi, /guardian.*guide/gi, /parent.*controls/gi],
            ccpa: [/california.*privacy/gi, /opt.*out.*sale/gi, /right.*to.*know/gi, /data.*disclosure/gi, /privacy.*rights.*act/gi, /california.*resident/gi, /personal.*information.*request/gi, /data.*access.*request/gi],
            fair_terms: [/reasonable.*notice/gi, /due.*process/gi, /appeal.*rights/gi, /dispute.*resolution/gi, /mediation/gi, /fair.*terms/gi, /user.*control/gi, /data.*minimization/gi, /purpose.*limitation/gi, /storage.*limitation/gi],
            privacy_best_practices: [/data.*minimization/gi, /purpose.*limitation/gi, /storage.*limitation/gi, /accuracy.*data/gi, /confidentiality.*security/gi, /accountability/gi, /transparency/gi, /user.*consent/gi, /opt.*in.*consent/gi, /granular.*consent/gi]
        };

        // Enhanced risk deductions (nuanced scoring for different company types)
        const riskDeductions = {
            // Major privacy violations (heavily penalized)
            data_selling: 45,                 // Extremely problematic - selling user data
            extensive_data_sharing: 40,       // Major privacy concern - sharing with many parties
            excessive_data_collection: 30,     // Significant concern - but common for personalization
            broad_data_use: 30,               // Significant concern - but common for services
            
            // Standard business practices (moderately penalized)
            mandatory_arbitration: 12,        // Common for tech companies
            broad_liability_waivers: 18,      // Standard business practice
            unilateral_changes: 8,            // Standard practice
            sole_discretion_clauses: 8,       // Common business practice
            automatic_renewal: 8,             // Common subscription model
            
            // Moderate concerns
            lack_of_user_control: 25,         // Significant but varies by service
            indefinite_data_retention: 20,     // Problematic but common
            waiver_of_rights: 18,             // Concerning but standard
            broad_termination_rights: 15,     // Reasonable for service providers
            no_refunds: 6                     // Minor issue
        };

        // Enhanced compliance bonuses (better recognition of good practices)
        const complianceBonuses = {
            gdpr: 18,                    // Important privacy protection
            coppa: 15,                   // Child protection
            ccpa: 15,                    // Consumer rights
            fair_terms: 25,              // Significant positive - transparent practices
            privacy_best_practices: 25   // Significant positive - privacy-first approach
        };

        function findSentenceBoundary(text, position, direction) {
            // Look for sentence boundaries (periods, exclamation marks, question marks)
            const sentenceEndings = /[.!?]\s+/g;
            const sentenceStartings = /[.!?]\s+[A-Z]/g;
            
            if (direction === 'backward') {
                // Look backward for the start of the sentence
                let currentPos = position;
                while (currentPos > 0) {
                    // Check if we found a sentence ending before current position
                    const beforeText = text.substring(0, currentPos);
                    const lastSentenceEnd = beforeText.lastIndexOf('.');
                    const lastExclamation = beforeText.lastIndexOf('!');
                    const lastQuestion = beforeText.lastIndexOf('?');
                    const lastEnding = Math.max(lastSentenceEnd, lastExclamation, lastQuestion);
                    
                    if (lastEnding > 0 && lastEnding < currentPos - 10) {
                        // Found a sentence boundary, return position after it
                        return lastEnding + 1;
                    }
                    
                    // If no sentence boundary found, look for paragraph breaks or line breaks
                    const lastNewline = beforeText.lastIndexOf('\n');
                    if (lastNewline > 0 && lastNewline < currentPos - 20) {
                        return lastNewline + 1;
                    }
                    
                    // Fallback: go back 100 characters or to beginning
                    currentPos = Math.max(0, currentPos - 100);
                    if (currentPos === 0) break;
                }
                return Math.max(0, position - 100);
            } else {
                // Look forward for the end of the sentence
                let currentPos = position;
                while (currentPos < text.length) {
                    const afterText = text.substring(currentPos);
                    const nextSentenceEnd = afterText.search(/[.!?]\s+/);
                    
                    if (nextSentenceEnd > 0) {
                        return currentPos + nextSentenceEnd + 1;
                    }
                    
                    // If no sentence boundary found, look for paragraph breaks
                    const nextNewline = afterText.search(/\n\n/);
                    if (nextNewline > 0) {
                        return currentPos + nextNewline + 2;
                    }
                    
                    // Fallback: go forward 100 characters or to end
                    currentPos = Math.min(text.length, currentPos + 100);
                    if (currentPos === text.length) break;
                }
                return Math.min(text.length, position + 100);
            }
        }

        function detectRisks(content) {
            const risks = {};
            
            for (const [riskType, patterns] of Object.entries(riskPatterns)) {
                const foundClauses = [];
                
                for (const pattern of patterns) {
                    const matches = content.matchAll(pattern);
                    for (const match of matches) {
                        // Find proper sentence boundaries
                        const sentenceStart = findSentenceBoundary(content, match.index, 'backward');
                        const sentenceEnd = findSentenceBoundary(content, match.index + match[0].length, 'forward');
                        const context = content.substring(sentenceStart, sentenceEnd).trim();
                        
                        foundClauses.push({
                            match: match[0],
                            context: context
                        });
                    }
                }
                
                if (foundClauses.length > 0) {
                    risks[riskType] = foundClauses;
                }
            }
            
            return risks;
        }

        function checkCompliance(content) {
            const compliance = {};
            
            for (const [framework, patterns] of Object.entries(compliancePatterns)) {
                const foundClauses = [];
                
                for (const pattern of patterns) {
                    const matches = content.matchAll(pattern);
                    for (const match of matches) {
                        // Find proper sentence boundaries
                        const sentenceStart = findSentenceBoundary(content, match.index, 'backward');
                        const sentenceEnd = findSentenceBoundary(content, match.index + match[0].length, 'forward');
                        const context = content.substring(sentenceStart, sentenceEnd).trim();
                        
                        foundClauses.push({
                            match: match[0],
                            context: context
                        });
                    }
                }
                
                if (foundClauses.length > 0) {
                    compliance[framework] = foundClauses;
                }
            }
            
            return compliance;
        }

        function calculateFairnessScore(risks, compliance) {
            let baseScore = 100;
            
            // Deduct points for risks
            for (const [riskType, clauses] of Object.entries(risks)) {
                if (riskType in riskDeductions) {
                    baseScore -= riskDeductions[riskType];
                }
            }
            
            // Add points for compliance
            for (const [framework, clauses] of Object.entries(compliance)) {
                if (framework in complianceBonuses) {
                    baseScore += complianceBonuses[framework];
                }
            }
            
            return Math.max(0, Math.min(100, baseScore));
        }

        function generateRecommendations(risks, compliance) {
            const recommendations = [];
            
            if (risks.mandatory_arbitration) {
                recommendations.push("‚ö†Ô∏è Remove mandatory arbitration clause - users should have right to sue in court");
            }
            if (risks.broad_liability_waivers) {
                recommendations.push("‚ö†Ô∏è Limit liability waivers - complete immunity is unfair to users");
            }
            if (risks.broad_termination_rights) {
                recommendations.push("‚ö†Ô∏è Add due process for account termination - vague standards are unfair");
            }
            if (risks.automatic_renewal) {
                recommendations.push("‚ö†Ô∏è Make subscription cancellation easier - automatic renewal can be deceptive");
            }
            if (risks.excessive_data_collection) {
                recommendations.push("üö® Limit data collection to what's necessary - excessive collection violates privacy");
            }
            if (risks.no_refunds) {
                recommendations.push("‚ö†Ô∏è Provide clear refund policies - no-refund policies can be unfair");
            }
            if (risks.data_selling) {
                recommendations.push("üö® Prohibit selling user data - this violates user trust and privacy");
            }
            if (risks.unilateral_changes) {
                recommendations.push("‚ö†Ô∏è Require notice for material changes - unilateral changes are unfair");
            }
            if (risks.sole_discretion_clauses) {
                recommendations.push("‚ö†Ô∏è Add objective standards - 'sole discretion' is too vague");
            }
            if (risks.waiver_of_rights) {
                recommendations.push("üö® Remove broad rights waivers - users should retain basic legal rights");
            }
            if (risks.extensive_data_sharing) {
                recommendations.push("üö® Limit data sharing - extensive sharing with third parties violates privacy");
            }
            if (risks.indefinite_data_retention) {
                recommendations.push("‚ö†Ô∏è Set clear data retention limits - indefinite retention is unfair");
            }
            if (risks.broad_data_use) {
                recommendations.push("‚ö†Ô∏è Limit data use to stated purposes - broad use violates user expectations");
            }
            if (risks.lack_of_user_control) {
                recommendations.push("üö® Give users control over their data - lack of control is unfair");
            }
            
            // Add compliance recommendations
            if (!compliance.gdpr) {
                recommendations.push("üìã Add GDPR compliance clauses for EU users");
            }
            if (!compliance.ccpa) {
                recommendations.push("üìã Add CCPA compliance for California users");
            }
            if (!compliance.fair_terms) {
                recommendations.push("üìã Add fair dispute resolution process");
            }
            if (!compliance.privacy_best_practices) {
                recommendations.push("üìã Implement privacy by design principles");
            }
            
            if (recommendations.length === 0) {
                recommendations.push("‚úÖ Document appears to have fair terms");
            }
            
            return recommendations;
        }

        function displayResults(risks, compliance, fairnessScore, recommendations) {
            // Display score
            const scoreElement = document.getElementById('scoreNumber');
            const statusElement = document.getElementById('status');
            
            scoreElement.textContent = `${fairnessScore}/100`;
            scoreElement.className = 'score-number';
            
            if (fairnessScore >= 80) {
                statusElement.textContent = '‚úÖ FAIR';
                scoreElement.classList.add('score-fair');
            } else if (fairnessScore >= 60) {
                statusElement.textContent = '‚ö†Ô∏è MODERATE';
                scoreElement.classList.add('score-moderate');
            } else {
                statusElement.textContent = 'üö® UNFAIR';
                scoreElement.classList.add('score-unfair');
            }
            
            // Display risks
            const riskAnalysis = document.getElementById('riskAnalysis');
            if (Object.keys(risks).length > 0) {
                let riskHtml = '<h3>‚ö†Ô∏è Risk Analysis</h3>';
                for (const [riskType, clauses] of Object.entries(risks)) {
                    const riskName = riskType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                    riskHtml += `<div class="result-item risk">
                        <strong>${riskName}:</strong> ${clauses.length} concerning clause(s)
                        <ul style="margin-top: 10px; margin-left: 20px;">
                    `;
                    clauses.slice(0, 2).forEach(clause => {
                        const context = clause.context.length > 80 ? 
                            clause.context.substring(0, 80) + '...' : clause.context;
                        riskHtml += `<li>"${context}"</li>`;
                    });
                    riskHtml += '</ul></div>';
                }
                riskAnalysis.innerHTML = riskHtml;
            } else {
                riskAnalysis.innerHTML = '<div class="result-item compliance"><strong>‚úÖ No risks detected</strong></div>';
            }
            
            // Display compliance
            const complianceCheck = document.getElementById('complianceCheck');
            if (Object.keys(compliance).length > 0) {
                let complianceHtml = '<h3>üõ°Ô∏è Compliance Check</h3>';
                for (const [framework, clauses] of Object.entries(compliance)) {
                    const frameworkName = framework.toUpperCase();
                    complianceHtml += `<div class="result-item compliance">
                        <strong>${frameworkName}:</strong> ‚úÖ Found ${clauses.length} compliance-related clause(s)
                    </div>`;
                }
                complianceCheck.innerHTML = complianceHtml;
            } else {
                complianceCheck.innerHTML = '<div class="result-item risk"><strong>‚ùå No compliance clauses found</strong></div>';
            }
            
            // Display recommendations
            const recommendationsDiv = document.getElementById('recommendations');
            let recHtml = '<h3>üí° Recommendations</h3>';
            recommendations.forEach(rec => {
                recHtml += `<div class="result-item recommendation">${rec}</div>`;
            });
            recommendationsDiv.innerHTML = recHtml;
        }

        function analyzeDocument() {
            const content = document.getElementById('documentContent').value;
            const title = document.getElementById('documentTitle').value;
            
            if (!content.trim()) {
                alert('Please enter document content');
                return;
            }
            
            // Show loading
            document.getElementById('loadingSection').classList.remove('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            
            // Simulate processing time
            setTimeout(() => {
                const risks = detectRisks(content);
                const compliance = checkCompliance(content);
                const fairnessScore = calculateFairnessScore(risks, compliance);
                const recommendations = generateRecommendations(risks, compliance);
                
                // Hide loading, show results
                document.getElementById('loadingSection').classList.add('hidden');
                document.getElementById('resultsSection').classList.remove('hidden');
                
                displayResults(risks, compliance, fairnessScore, recommendations);
            }, 2000);
        }

        function loadSampleDocument() {
            document.getElementById('documentTitle').value = 'Fair Terms of Service Example';
            document.getElementById('documentContent').value = `Terms of Service - Fair Example

1. FAIR DISPUTE RESOLUTION
We prefer to resolve disputes through direct communication. If that fails, we offer mediation. You retain the right to sue in court for any dispute. No mandatory arbitration.

2. REASONABLE LIABILITY
We are liable for damages caused by our negligence up to the amount you paid us. We do not limit liability for personal injury or fraud.

3. MINIMAL DATA COLLECTION
We only collect data necessary to provide our service:
- Account information for login
- Payment information for transactions
- Basic usage data to improve service quality

4. NO DATA SELLING
We never sell your personal information to third parties. We only share data with service providers under strict confidentiality agreements.

5. TRANSPARENT CHANGES
We provide 60 days notice for any changes to these terms. You can cancel your account and receive a prorated refund if you disagree with changes.

6. FAIR TERMINATION
We only terminate accounts for clear violations of these terms with 30 days notice and opportunity to appeal.

7. GENEROUS REFUND POLICY
Full refunds available within 90 days for any reason. Prorated refunds for annual subscriptions.

8. LIMITED DATA RETENTION
We delete your data within 30 days of account closure, except as required by law.

9. STRONG USER CONTROL
You can:
- Delete your account anytime
- Export all your data
- Opt out of all data collection
- Request data deletion
- Disable tracking cookies

10. COMPREHENSIVE PRIVACY RIGHTS
- GDPR compliance for EU users
- CCPA compliance for California users
- Right to know what data we collect
- Right to request deletion
- Right to data portability
- Right to opt out of data sharing

11. PRIVACY BY DESIGN
- Data minimization principles
- Purpose limitation
- Storage limitation
- Accuracy and security
- Transparency and accountability

12. CONTACT INFORMATION
For questions about these terms or your rights:
- Email: privacy@example.com
- Phone: 1-800-EXAMPLE
- Address: 123 Fair Street, Privacy City, PC 12345

We believe in fair, transparent terms that protect both users and our business.`;
        }

        // Chatbot functionality
        let currentAnalysis = null;

        function addMessage(content, isUser = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function generateChatbotResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            // Store current analysis for chatbot context
            if (currentAnalysis) {
                const { risks, compliance, fairnessScore, recommendations } = currentAnalysis;
                const documentContent = document.getElementById('documentContent').value;
                
                // Document-specific responses
                if (message.includes('score') || message.includes('fairness')) {
                    return `üìä <strong>Fairness Score: ${fairnessScore}/100</strong><br><br>
                    This score is based on:<br>
                    ‚Ä¢ <strong>Risk deductions:</strong> Unfair clauses reduce the score<br>
                    ‚Ä¢ <strong>Compliance bonuses:</strong> Good privacy practices increase the score<br><br>
                    <strong>Score breakdown:</strong>
                    ‚Ä¢ 80-100: ‚úÖ FAIR - Good terms and practices
                    ‚Ä¢ 60-79: ‚ö†Ô∏è MODERATE - Some concerns but generally acceptable
                    ‚Ä¢ 0-59: üö® UNFAIR - Significant problems that need addressing<br><br>
                    <strong>Current analysis found:</strong> ${Object.keys(risks).length} risk categories and ${Object.keys(compliance).length} compliance frameworks.`;
                }
                
                if (message.includes('recommend') || message.includes('improve')) {
                    return `üí° <strong>Recommendations for Improvement:</strong><br><br>
                    Based on the analysis, here are the key areas to address:<br><br>
                    ${recommendations.map(rec => `‚Ä¢ ${rec}`).join('<br>')}<br><br>
                    <strong>Priority actions:</strong>
                    ‚Ä¢ Address high-risk items first (data selling, arbitration, liability waivers)
                    ‚Ä¢ Add missing compliance clauses (GDPR, CCPA)
                    ‚Ä¢ Improve user control over data
                    ‚Ä¢ Set clear data retention limits`;
                }
                
                // Document-specific questions
                if (message.includes('what') && message.includes('risks') || message.includes('problems') || message.includes('issues')) {
                    if (Object.keys(risks).length === 0) {
                        return `‚úÖ <strong>No major risks detected!</strong><br><br>
                        The document appears to have fair terms with no significant problematic clauses identified.`;
                    }
                    
                    let response = `üö® <strong>Risks Found in This Document:</strong><br><br>`;
                    for (const [riskType, clauses] of Object.entries(risks)) {
                        const riskName = riskType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                        response += `<strong>${riskName}:</strong> ${clauses.length} concerning clause(s)<br>`;
                        clauses.slice(0, 2).forEach(clause => {
                            response += `‚Ä¢ "${clause.context}"<br>`;
                        });
                        response += `<br>`;
                    }
                    return response;
                }
                
                if (message.includes('arbitration') || message.includes('arbitrate')) {
                    if (risks.mandatory_arbitration) {
                        const clauses = risks.mandatory_arbitration;
                        let response = `üîç <strong>Arbitration Issues Found:</strong><br><br>`;
                        response += `This document contains mandatory arbitration clauses that are concerning:<br><br>`;
                        clauses.forEach(clause => {
                            response += `‚Ä¢ "${clause.context}"<br><br>`;
                        });
                        response += `<strong>Why this is problematic:</strong><br>
                        ‚Ä¢ You lose your right to sue in court<br>
                        ‚Ä¢ Arbitrators often favor companies<br>
                        ‚Ä¢ Limited appeal rights<br>
                        ‚Ä¢ Can be more expensive than court`;
                        return response;
                    } else {
                        return `‚úÖ <strong>No Arbitration Issues Found</strong><br><br>
                        This document does not contain mandatory arbitration clauses, which is good for consumer rights.`;
                    }
                }
                
                if (message.includes('data') && (message.includes('collect') || message.includes('share') || message.includes('sell'))) {
                    let response = `üìä <strong>Data Collection Analysis:</strong><br><br>`;
                    
                    if (risks.excessive_data_collection) {
                        response += `üö® <strong>Excessive Data Collection Found:</strong><br>`;
                        risks.excessive_data_collection.forEach(clause => {
                            response += `‚Ä¢ "${clause.context}"<br>`;
                        });
                        response += `<br>`;
                    }
                    
                    if (risks.data_selling) {
                        response += `üö® <strong>Data Selling Found:</strong><br>`;
                        risks.data_selling.forEach(clause => {
                            response += `‚Ä¢ "${clause.context}"<br>`;
                        });
                        response += `<br>`;
                    }
                    
                    if (risks.extensive_data_sharing) {
                        response += `‚ö†Ô∏è <strong>Extensive Data Sharing Found:</strong><br>`;
                        risks.extensive_data_sharing.forEach(clause => {
                            response += `‚Ä¢ "${clause.context}"<br>`;
                        });
                        response += `<br>`;
                    }
                    
                    if (!risks.excessive_data_collection && !risks.data_selling && !risks.extensive_data_sharing) {
                        response += `‚úÖ <strong>No major data collection issues found</strong><br><br>
                        The document appears to have reasonable data collection practices.`;
                    }
                    
                    return response;
                }
                
                if (message.includes('liability') || message.includes('damages')) {
                    if (risks.broad_liability_waivers) {
                        const clauses = risks.broad_liability_waivers;
                        let response = `‚öñÔ∏è <strong>Liability Issues Found:</strong><br><br>`;
                        response += `This document contains broad liability waivers:<br><br>`;
                        clauses.forEach(clause => {
                            response += `‚Ä¢ "${clause.context}"<br><br>`;
                        });
                        response += `<strong>Why this is concerning:</strong><br>
                        ‚Ä¢ Gives companies complete immunity from damages<br>
                        ‚Ä¢ Limits your ability to recover losses<br>
                        ‚Ä¢ May be unfair to consumers`;
                        return response;
                    } else {
                        return `‚úÖ <strong>No Major Liability Issues Found</strong><br><br>
                        This document does not contain overly broad liability waivers.`;
                    }
                }
                
                if (message.includes('termination') || message.includes('account')) {
                    if (risks.broad_termination_rights) {
                        const clauses = risks.broad_termination_rights;
                        let response = `üö™ <strong>Account Termination Issues Found:</strong><br><br>`;
                        response += `This document contains concerning termination clauses:<br><br>`;
                        clauses.forEach(clause => {
                            response += `‚Ä¢ "${clause.context}"<br><br>`;
                        });
                        response += `<strong>Why this is problematic:</strong><br>
                        ‚Ä¢ Vague standards for termination<br>
                        ‚Ä¢ No due process requirements<br>
                        ‚Ä¢ Can terminate without clear reasons`;
                        return response;
                    } else {
                        return `‚úÖ <strong>No Major Termination Issues Found</strong><br><br>
                        This document appears to have reasonable account termination policies.`;
                    }
                }
                
                if (message.includes('refund') || message.includes('money back')) {
                    if (risks.no_refunds) {
                        const clauses = risks.no_refunds;
                        let response = `üí∞ <strong>Refund Policy Issues Found:</strong><br><br>`;
                        response += `This document contains concerning refund policies:<br><br>`;
                        clauses.forEach(clause => {
                            response += `‚Ä¢ "${clause.context}"<br><br>`;
                        });
                        response += `<strong>Why this is problematic:</strong><br>
                        ‚Ä¢ No refunds can be unfair to consumers<br>
                        ‚Ä¢ May violate consumer protection laws<br>
                        ‚Ä¢ Limits your ability to get money back`;
                        return response;
                    } else {
                        return `‚úÖ <strong>No Major Refund Issues Found</strong><br><br>
                        This document appears to have reasonable refund policies.`;
                    }
                }
                
                if (message.includes('changes') || message.includes('modify') || message.includes('update')) {
                    if (risks.unilateral_changes) {
                        const clauses = risks.unilateral_changes;
                        let response = `üìù <strong>Change Policy Issues Found:</strong><br><br>`;
                        response += `This document contains concerning change policies:<br><br>`;
                        clauses.forEach(clause => {
                            response += `‚Ä¢ "${clause.context}"<br><br>`;
                        });
                        response += `<strong>Why this is problematic:</strong><br>
                        ‚Ä¢ Can change terms without proper notice<br>
                        ‚Ä¢ Unilateral changes are unfair<br>
                        ‚Ä¢ May not give you time to opt out`;
                        return response;
                    } else {
                        return `‚úÖ <strong>No Major Change Policy Issues Found</strong><br><br>
                        This document appears to have reasonable change policies.`;
                    }
                }
                
                if (message.includes('compliance') || message.includes('gdpr') || message.includes('ccpa')) {
                    let response = `üõ°Ô∏è <strong>Compliance Analysis:</strong><br><br>`;
                    
                    if (Object.keys(compliance).length === 0) {
                        response += `‚ùå <strong>No compliance frameworks detected</strong><br><br>
                        This document does not appear to have explicit GDPR, CCPA, or other privacy compliance clauses.`;
                    } else {
                        response += `‚úÖ <strong>Compliance frameworks found:</strong><br>`;
                        for (const [framework, clauses] of Object.entries(compliance)) {
                            const frameworkName = framework.toUpperCase();
                            response += `‚Ä¢ <strong>${frameworkName}:</strong> ${clauses.length} compliance clause(s)<br>`;
                        }
                    }
                    
                    return response;
                }
                
                if (message.includes('summary') || message.includes('overview')) {
                    let response = `üìã <strong>Document Summary:</strong><br><br>`;
                    response += `‚Ä¢ <strong>Fairness Score:</strong> ${fairnessScore}/100<br>`;
                    response += `‚Ä¢ <strong>Risk Categories:</strong> ${Object.keys(risks).length}<br>`;
                    response += `‚Ä¢ <strong>Compliance Frameworks:</strong> ${Object.keys(compliance).length}<br><br>`;
                    
                    if (Object.keys(risks).length > 0) {
                        response += `<strong>Main Issues:</strong><br>`;
                        Object.keys(risks).slice(0, 3).forEach(risk => {
                            const riskName = risk.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                            response += `‚Ä¢ ${riskName}<br>`;
                        });
                        response += `<br>`;
                    }
                    
                    if (Object.keys(compliance).length > 0) {
                        response += `<strong>Compliance:</strong><br>`;
                        Object.keys(compliance).forEach(framework => {
                            response += `‚Ä¢ ${framework.toUpperCase()}<br>`;
                        });
                    }
                    
                    return response;
                }
                
                // Search for specific terms in the document
                if (message.includes('search') || message.includes('find')) {
                    const searchTerm = message.replace(/search|find/gi, '').trim();
                    if (searchTerm.length > 2) {
                        const searchRegex = new RegExp(searchTerm, 'gi');
                        const matches = documentContent.match(searchRegex);
                        
                        if (matches) {
                            return `üîç <strong>Search Results for "${searchTerm}":</strong><br><br>
                            Found ${matches.length} occurrence(s) in the document.<br><br>
                            <strong>Context:</strong><br>
                            The term appears in the document content. You can search for specific phrases to find relevant clauses.`;
                        } else {
                            return `üîç <strong>Search Results for "${searchTerm}":</strong><br><br>
                            No exact matches found in the document. Try a different search term.`;
                        }
                    }
                }
            }
            
            // Comprehensive legal term explanations
            if (message.includes('arbitration') || message.includes('arbitrate')) {
                return `üîç <strong>Arbitration Explained:</strong><br><br>
                Arbitration is when disputes are settled outside of court by a private arbitrator instead of a judge and jury. <strong>Mandatory arbitration clauses</strong> force you to give up your right to sue in court.<br><br>
                <strong>Why it's problematic:</strong>
                ‚Ä¢ You lose your constitutional right to a jury trial
                ‚Ä¢ Arbitrators often favor companies over consumers
                ‚Ä¢ Limited appeal rights
                ‚Ä¢ Can be more expensive than court
                ‚Ä¢ Companies choose the arbitration provider<br><br>
                <strong>Real examples:</strong>
                ‚Ä¢ TikTok: "Any dispute...shall be resolved by binding arbitration"
                ‚Ä¢ Spotify: "THESE TERMS CONTAIN A MANDATORY ARBITRATION PROVISION"
                ‚Ä¢ Uber: "You and Uber agree to resolve any disputes through binding arbitration"<br><br>
                <strong>Your rights:</strong> Some states allow you to opt out of arbitration clauses. Check your local consumer protection laws.`;
            }
            
            if (message.includes('liability') || message.includes('damages')) {
                return `‚öñÔ∏è <strong>Liability Waivers Explained:</strong><br><br>
                Liability waivers protect companies from being sued for damages, even when they're at fault. <strong>Broad liability waivers</strong> can be unfair because they give companies complete immunity.<br><br>
                <strong>What to watch for:</strong>
                ‚Ä¢ "As is" and "as available" disclaimers
                ‚Ä¢ "No liability for damages" clauses
                ‚Ä¢ "Disclaim all warranties" language
                ‚Ä¢ Limits on consequential damages
                ‚Ä¢ "Not responsible for any losses"<br><br>
                <strong>Real examples:</strong>
                ‚Ä¢ Facebook: "We provide the Service 'as is' without any warranties"
                ‚Ä¢ Instagram: "We are not liable for any indirect, incidental, special, consequential, or punitive damages"
                ‚Ä¢ Twitter: "We disclaim all warranties...to the fullest extent permitted by law"<br><br>
                <strong>Fair terms should:</strong> Allow reasonable liability while protecting against frivolous lawsuits.`;
            }
            
            if (message.includes('data') && (message.includes('collect') || message.includes('share') || message.includes('sell'))) {
                return `üìä <strong>Data Collection & Sharing:</strong><br><br>
                Companies collect various types of data about you. <strong>Excessive data collection</strong> goes beyond what's necessary to provide the service.<br><br>
                <strong>Red flags:</strong>
                ‚Ä¢ Collecting biometric data (fingerprints, face scans)
                ‚Ä¢ Tracking across multiple websites
                ‚Ä¢ Sharing with third parties for advertising
                ‚Ä¢ Collecting precise location data
                ‚Ä¢ Selling data to advertisers
                ‚Ä¢ Collecting keystroke patterns
                ‚Ä¢ Accessing clipboard information<br><br>
                <strong>Real examples:</strong>
                ‚Ä¢ TikTok: Collects "biometric identifiers," "keystroke patterns," "clipboard information"
                ‚Ä¢ Facebook: Tracks you across websites with "pixel" technology
                ‚Ä¢ Google: Collects location data even when apps are closed
                ‚Ä¢ Instagram: Uses your photos to train AI algorithms<br><br>
                <strong>Your rights:</strong> GDPR (EU) and CCPA (California) give you rights to know what data is collected, request deletion, and opt out of data selling.`;
            }
            
            if (message.includes('privacy') || message.includes('gdpr') || message.includes('ccpa')) {
                return `üõ°Ô∏è <strong>Privacy Rights & Compliance:</strong><br><br>
                <strong>GDPR (EU):</strong> Right to know what data is collected, request deletion, data portability, and explicit consent.<br><br>
                <strong>CCPA (California):</strong> Right to know what personal information is collected, opt out of data selling, and request deletion.<br><br>
                <strong>Fair privacy practices:</strong>
                ‚Ä¢ Data minimization (only collect what's necessary)
                ‚Ä¢ Purpose limitation (use data only for stated purposes)
                ‚Ä¢ Storage limitation (don't keep data forever)
                ‚Ä¢ User control (ability to delete account/data)
                ‚Ä¢ Transparency (clear privacy policies)<br><br>
                <strong>Real examples:</strong>
                ‚Ä¢ Apple: Strong privacy stance, minimal data collection
                ‚Ä¢ DuckDuckGo: No tracking, no personal data collection
                ‚Ä¢ Signal: End-to-end encryption, no data collection`;
            }
            
            if (message.includes('termination') || message.includes('account')) {
                return `üö™ <strong>Account Termination Rights:</strong><br><br>
                <strong>Fair termination policies should:</strong>
                ‚Ä¢ Give reasonable notice before termination
                ‚Ä¢ Provide clear reasons for termination
                ‚Ä¢ Allow appeal process
                ‚Ä¢ Not terminate without cause<br><br>
                <strong>Red flags:</strong>
                ‚Ä¢ "Terminate at any time without notice"
                ‚Ä¢ "Sole discretion" without objective standards
                ‚Ä¢ Vague violation standards
                ‚Ä¢ No appeal process<br><br>
                <strong>Real examples:</strong>
                ‚Ä¢ Twitter: Can suspend accounts for "violation of terms"
                ‚Ä¢ YouTube: Can terminate channels for "repeated violations"
                ‚Ä¢ Instagram: Can disable accounts "at any time"<br><br>
                <strong>Your rights:</strong> You should have due process and clear standards for account termination.`;
            }
            
            // Platform-specific information
            if (message.includes('tiktok') || message.includes('bytedance')) {
                return `üì± <strong>TikTok Privacy & Terms Analysis:</strong><br><br>
                <strong>Major concerns with TikTok:</strong><br>
                ‚Ä¢ <strong>Data collection:</strong> Biometric data, keystroke patterns, clipboard info, precise location<br>
                ‚Ä¢ <strong>Data sharing:</strong> Shares with ByteDance, Chinese government access concerns<br>
                ‚Ä¢ <strong>Arbitration:</strong> Mandatory arbitration for all disputes<br>
                ‚Ä¢ <strong>Content ownership:</strong> You grant TikTok "perpetual, irrevocable" rights to your content<br>
                ‚Ä¢ <strong>AI training:</strong> Uses your content to train AI algorithms<br><br>
                <strong>Privacy risks:</strong>
                ‚Ä¢ Collects more data than necessary for video sharing
                ‚Ä¢ Tracks across other apps and websites
                ‚Ä¢ Shares data with parent company ByteDance
                ‚Ä¢ Potential Chinese government access<br><br>
                <strong>Your rights:</strong> You can request data deletion, but TikTok retains broad rights to your content.`;
            }
            
            if (message.includes('facebook') || message.includes('meta')) {
                return `üìò <strong>Facebook/Meta Privacy & Terms Analysis:</strong><br><br>
                <strong>Major concerns with Facebook:</strong><br>
                ‚Ä¢ <strong>Data collection:</strong> Tracks across websites, collects biometric data, location<br>
                ‚Ä¢ <strong>Data sharing:</strong> Shares with advertisers, business partners, third parties<br>
                ‚Ä¢ <strong>Arbitration:</strong> Mandatory arbitration for most disputes<br>
                ‚Ä¢ <strong>Content rights:</strong> You grant Facebook broad rights to use your content<br>
                ‚Ä¢ <strong>AI training:</strong> Uses your posts and photos to train AI<br><br>
                <strong>Privacy risks:</strong>
                ‚Ä¢ Tracks you across the internet with "pixel" technology
                ‚Ä¢ Collects data from other apps and websites
                ‚Ä¢ Shares data with thousands of advertisers
                ‚Ä¢ Uses facial recognition without clear consent<br><br>
                <strong>Your rights:</strong> You can download your data and delete your account, but Facebook retains broad usage rights.`;
            }
            
            if (message.includes('google') || message.includes('alphabet')) {
                return `üîç <strong>Google Privacy & Terms Analysis:</strong><br><br>
                <strong>Major concerns with Google:</strong><br>
                ‚Ä¢ <strong>Data collection:</strong> Tracks across all Google services, location history, search history<br>
                ‚Ä¢ <strong>Data sharing:</strong> Shares data across Google services, with advertisers<br>
                ‚Ä¢ <strong>Arbitration:</strong> Mandatory arbitration for most disputes<br>
                ‚Ä¢ <strong>AI training:</strong> Uses your data to train AI models<br>
                ‚Ä¢ <strong>Location tracking:</strong> Tracks location even when apps are closed<br><br>
                <strong>Privacy risks:</strong>
                ‚Ä¢ Collects data from Gmail, Maps, Search, YouTube, Chrome
                ‚Ä¢ Tracks location history across devices
                ‚Ä¢ Uses data for targeted advertising
                ‚Ä¢ Shares data across all Google services<br><br>
                <strong>Your rights:</strong> You can download your data, but Google retains broad rights to use it for AI training and advertising.`;
            }
            
            if (message.includes('apple')) {
                return `üçé <strong>Apple Privacy & Terms Analysis:</strong><br><br>
                <strong>Apple's privacy stance:</strong><br>
                ‚Ä¢ <strong>Data minimization:</strong> Collects minimal data necessary for services<br>
                ‚Ä¢ <strong>On-device processing:</strong> Many features process data on your device<br>
                ‚Ä¢ <strong>No data selling:</strong> Doesn't sell personal information to third parties<br>
                ‚Ä¢ <strong>Transparency:</strong> Clear privacy labels and data usage explanations<br>
                ‚Ä¢ <strong>User control:</strong> Strong account deletion and data export options<br><br>
                <strong>Privacy strengths:</strong>
                ‚Ä¢ App Tracking Transparency (ATT) framework
                ‚Ä¢ Privacy-focused advertising (no personal data shared)
                ‚Ä¢ End-to-end encryption for iMessage and FaceTime
                ‚Ä¢ Minimal data collection compared to competitors<br><br>
                <strong>Your rights:</strong> Strong privacy protections, but some data still collected for services.`;
            }
            
            // Legal rights and consumer protection
            if (message.includes('rights') || message.includes('consumer')) {
                return `‚öñÔ∏è <strong>Your Consumer Rights:</strong><br><br>
                <strong>Federal Rights (USA):</strong><br>
                ‚Ä¢ Right to know what data is collected about you
                ‚Ä¢ Right to dispute billing errors
                ‚Ä¢ Right to cancel services with proper notice
                ‚Ä¢ Right to sue for fraud or personal injury
                ‚Ä¢ Right to opt out of telemarketing<br><br>
                <strong>State Rights:</strong><br>
                ‚Ä¢ <strong>California (CCPA):</strong> Right to know, delete, and opt out of data selling
                ‚Ä¢ <strong>Virginia (CDPA):</strong> Similar rights to California
                ‚Ä¢ <strong>Colorado (CPA):</strong> Consumer privacy rights
                ‚Ä¢ <strong>Connecticut (CTDPA):</strong> Privacy protections<br><br>
                <strong>How to exercise your rights:</strong>
                ‚Ä¢ Contact companies directly
                ‚Ä¢ Use privacy request forms
                ‚Ä¢ File complaints with state attorneys general
                ‚Ä¢ Consider legal action for serious violations`;
            }
            
            if (message.includes('delete') || message.includes('remove')) {
                return `üóëÔ∏è <strong>How to Delete Your Data:</strong><br><br>
                <strong>Account Deletion:</strong><br>
                ‚Ä¢ <strong>Facebook:</strong> Settings > Your Facebook Information > Deactivation and Deletion
                ‚Ä¢ <strong>Instagram:</strong> Settings > Account > Delete Account
                ‚Ä¢ <strong>Twitter:</strong> Settings > Your Account > Deactivate Account
                ‚Ä¢ <strong>TikTok:</strong> Profile > Settings > Privacy > Delete Account
                ‚Ä¢ <strong>Google:</strong> myaccount.google.com > Data & Privacy > Delete Account<br><br>
                <strong>Data Download:</strong><br>
                ‚Ä¢ Most platforms allow you to download your data before deletion
                ‚Ä¢ Look for "Download Your Data" or "Data Export" options
                ‚Ä¢ This gives you a copy of everything they have about you<br><br>
                <strong>Important notes:</strong>
                ‚Ä¢ Some data may be retained for legal reasons
                ‚Ä¢ Deletion may take 30-90 days to complete
                ‚Ä¢ You may lose access to purchased content
                ‚Ä¢ Consider downloading data first`;
            }
            
            if (message.includes('opt out') || message.includes('tracking')) {
                return `üö´ <strong>How to Opt Out of Tracking:</strong><br><br>
                <strong>Browser Settings:</strong><br>
                ‚Ä¢ Enable "Do Not Track" in your browser
                ‚Ä¢ Block third-party cookies
                ‚Ä¢ Use privacy-focused browsers (Brave, Firefox)
                ‚Ä¢ Install ad blockers and tracking blockers<br><br>
                <strong>Platform Settings:</strong><br>
                ‚Ä¢ <strong>Facebook:</strong> Settings > Privacy > Limit data sharing
                ‚Ä¢ <strong>Google:</strong> myaccount.google.com > Data & Privacy > Ad personalization
                ‚Ä¢ <strong>Apple:</strong> Settings > Privacy > Tracking > Ask App Not to Track<br><br>
                <strong>Mobile Settings:</strong><br>
                ‚Ä¢ Disable location tracking for apps
                ‚Ä¢ Limit ad tracking on iOS
                ‚Ä¢ Use app permissions carefully
                ‚Ä¢ Consider using privacy-focused apps<br><br>
                <strong>Additional steps:</strong>
                ‚Ä¢ Use VPN services
                ‚Ä¢ Consider privacy-focused alternatives
                ‚Ä¢ Regularly review and update privacy settings`;
            }
            
            // General legal help
            if (message.includes('help') || message.includes('what can you do')) {
                return `ü§ñ <strong>I can help you with:</strong><br><br>
                <strong>üì± Platform Analysis:</strong>
                ‚Ä¢ TikTok, Facebook, Google, Apple, and other major platforms
                ‚Ä¢ Privacy policies and terms of service analysis
                ‚Ä¢ Data collection and sharing practices<br><br>
                <strong>‚öñÔ∏è Legal Terms:</strong>
                ‚Ä¢ Arbitration clauses and your rights
                ‚Ä¢ Liability waivers and damages
                ‚Ä¢ Data collection and privacy rights
                ‚Ä¢ Account termination policies<br><br>
                <strong>üõ°Ô∏è Privacy Rights:</strong>
                ‚Ä¢ GDPR (EU) and CCPA (California) rights
                ‚Ä¢ How to delete your data
                ‚Ä¢ How to opt out of tracking
                ‚Ä¢ Consumer protection laws<br><br>
                <strong>üí° Practical Help:</strong>
                ‚Ä¢ Step-by-step deletion guides
                ‚Ä¢ Privacy setting recommendations
                ‚Ä¢ Alternative privacy-focused services
                ‚Ä¢ Legal rights and remedies<br><br>
                <strong>Try asking:</strong> "Tell me about TikTok's privacy", "How do I delete my Facebook data?", "What are my CCPA rights?", "How to opt out of tracking?"`;
            }
            
            if (message.includes('hello') || message.includes('hi')) {
                return `üëã Hello! I'm your comprehensive legal assistant. I can help you with:<br><br>
                ‚Ä¢ <strong>Platform analysis:</strong> TikTok, Facebook, Google, Apple, and more<br>
                ‚Ä¢ <strong>Privacy rights:</strong> GDPR, CCPA, and consumer protection<br>
                ‚Ä¢ <strong>Legal terms:</strong> Arbitration, liability, data collection<br>
                ‚Ä¢ <strong>Practical help:</strong> How to delete data, opt out of tracking<br><br>
                What would you like to know about?`;
            }
            
            return `ü§î I'm not sure I understand. Try asking about:<br><br>
            <strong>üì± Platforms:</strong> "Tell me about TikTok's privacy", "Facebook data collection", "Google tracking"<br>
            <strong>‚öñÔ∏è Legal Terms:</strong> "What is arbitration?", "Explain liability waivers", "Data collection rights"<br>
            <strong>üõ°Ô∏è Privacy:</strong> "How to delete my data?", "CCPA rights", "Opt out of tracking"<br>
            <strong>üí° Help:</strong> "What can you do?", "Consumer rights", "Privacy tips"<br><br>
            Or type "help" for a full list of topics I can assist with!`;
        }

        function handleChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            input.value = '';
            
            // Show typing indicator
            addTypingIndicator();
            
            // Generate response after a short delay
            setTimeout(() => {
                removeTypingIndicator();
                const response = generateChatbotResponse(message);
                addMessage(response);
            }, 1000 + Math.random() * 1000); // Random delay for natural feel
        }

        // Update analyzeDocument to store analysis for chatbot
        function analyzeDocument() {
            const content = document.getElementById('documentContent').value;
            const title = document.getElementById('documentTitle').value;
            
            if (!content.trim()) {
                alert('Please enter document content');
                return;
            }
            
            // Show loading
            document.getElementById('loadingSection').classList.remove('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            
            // Simulate processing time
            setTimeout(() => {
                const risks = detectRisks(content);
                const compliance = checkCompliance(content);
                const fairnessScore = calculateFairnessScore(risks, compliance);
                const recommendations = generateRecommendations(risks, compliance);
                
                // Store analysis for chatbot
                currentAnalysis = { risks, compliance, fairnessScore, recommendations };
                
                // Hide loading, show results
                document.getElementById('loadingSection').classList.add('hidden');
                document.getElementById('resultsSection').classList.remove('hidden');
                
                displayResults(risks, compliance, fairnessScore, recommendations);
            }, 2000);
        }

        // Event listeners
        document.getElementById('analysisForm').addEventListener('submit', function(e) {
            e.preventDefault();
            analyzeDocument();
        });

        // Chatbot event listeners
        document.getElementById('sendMessage').addEventListener('click', handleChatMessage);
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleChatMessage();
            }
        });

        // Initialize with sample document
        loadSampleDocument();
    </script>
</body>
</html> 